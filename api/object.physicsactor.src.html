
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8">
   <title>object.physicsactor.js</title>
   <link rel=stylesheet href="default.css" type="text/css" media=screen>
   <meta name="generator" content="JsDoc Toolkit 1.0">
   <style>
      body {
         font-size: 10pt;
         font-family: Helvetica, Arial, san-serif;
      }

      .TableHeadingColor { font-size: 18pt; font-weight: bold; background: #CCCCFF; }
      .TableRowColor { background: #FFFFFF; }
      
      .jsdoc_ctime
      {
         font-family: Arial, Helvetica, sans-serif;
         font-size: 9pt;
         text-align: right;
      }
      .jsdoc_copy
      {
         font-family: Arial, Helvetica, sans-serif;
         font-size: 9pt;
         text-align: left;
         font-style: italic;
      }
   </style>
</head>
<body>
<div style="text-align: center;">
   <h1>object.physicsactor.js</h1>
</div>
<br/>
<h4>Summary</h4>


<br/>
<hr>
<table border="1" width="100%" cellpadding="2">
   <tr>
      <td colspan="2" class="TableHeadingColor">Class Summary</td>
   </tr>
   
      <tr class="TableRowColor">
         <td>
            <a href="PhysicsActor.html" target="main">PhysicsActor</a>
         </td>
         <td>
            
A <tt>PhysicsActor</tt> is an actor object within a game represented by		 a collection of components which can include rigid bodies and joints.
         </td>
      </tr>
   
</table>
<br/>
<hr>
<style>
         .KEYW {color: #933;}
         .COMM {color: #bbb; font-style: italic;}
         .NUMB {color: #393;}
         .STRN {color: #393;}
         .REGX {color: #339;}
         .linenumber {border-right: 1px dotted #666; color: #666; font-style: normal;}
         </style><pre><span class='linenumber'>  1</span> <span class="COMM">/**
<span class='linenumber'>  2</span>  * The Render Engine
<span class='linenumber'>  3</span>  *
<span class='linenumber'>  4</span>  * PhysicsActor object
<span class='linenumber'>  5</span>  *
<span class='linenumber'>  6</span>  * @author: Brett Fattori (brettf@renderengine.com)
<span class='linenumber'>  7</span>  *
<span class='linenumber'>  8</span>  * @author: $Author: bfattori $
<span class='linenumber'>  9</span>  * @version: $Revision: 1402 $
<span class='linenumber'> 10</span>  *
<span class='linenumber'> 11</span>  * Copyright (c) 2008 Brett Fattori (brettf@renderengine.com)
<span class='linenumber'> 12</span>  *
<span class='linenumber'> 13</span>  * Permission is hereby granted, free of charge, to any person obtaining a copy
<span class='linenumber'> 14</span>  * of this software and associated documentation files (the "Software"), to deal
<span class='linenumber'> 15</span>  * in the Software without restriction, including without limitation the rights
<span class='linenumber'> 16</span>  * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
<span class='linenumber'> 17</span>  * copies of the Software, and to permit persons to whom the Software is
<span class='linenumber'> 18</span>  * furnished to do so, subject to the following conditions:
<span class='linenumber'> 19</span>  *
<span class='linenumber'> 20</span>  * The above copyright notice and this permission notice shall be included in
<span class='linenumber'> 21</span>  * all copies or substantial portions of the Software.
<span class='linenumber'> 22</span>  *
<span class='linenumber'> 23</span>  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
<span class='linenumber'> 24</span>  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
<span class='linenumber'> 25</span>  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
<span class='linenumber'> 26</span>  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
<span class='linenumber'> 27</span>  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
<span class='linenumber'> 28</span>  * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
<span class='linenumber'> 29</span>  * THE SOFTWARE.
<span class='linenumber'> 30</span>  *
<span class='linenumber'> 31</span>  */</span><span class="WHIT">
<span class='linenumber'> 32</span> 
<span class='linenumber'> 33</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/components/component.circlebody.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 34</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/components/component.boxbody.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 35</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/components/component.distancejoint.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 36</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/components/component.revolutejoint.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 37</span> 
<span class='linenumber'> 38</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/engine/engine.math2d.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 39</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/engine/engine.object2d.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 40</span> </span><span class="NAME">Engine.include</span><span class="PUNC">(</span><span class="STRN">"/resourceloaders/loader.object.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 41</span> 
<span class='linenumber'> 42</span> </span><span class="NAME">Engine.initObject</span><span class="PUNC">(</span><span class="STRN">"PhysicsActor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Object2D"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 43</span> 
<span class='linenumber'> 44</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='linenumber'> 45</span> 	 * @class A &lt;tt>PhysicsActor&lt;/tt> is an actor object within a game represented by
<span class='linenumber'> 46</span> 	 * 		 a collection of components which can include rigid bodies and joints.
<span class='linenumber'> 47</span> 	 * 		 Unlike {@link Object2D}, a &lt;code>PhysicsActor&lt;/code> can associate each rigid
<span class='linenumber'> 48</span> 	 * 		 body with its own {@link RenderComponent}.  When the rigid body is updated, the
<span class='linenumber'> 49</span> 	 * 		 render component is updated with it.  That way, a physics actor can be comprised
<span class='linenumber'> 50</span> 	 * 		 of multiple bodies, each with their own renderer allowing for a complex object
<span class='linenumber'> 51</span> 	 * 		 such as a ragdoll with many parts and joints.  A physics actor is used within a
<span class='linenumber'> 52</span> 	 * 		 {@link Simulation}.
<span class='linenumber'> 53</span> 	 * 		 &lt;p/>
<span class='linenumber'> 54</span> 	 * 		 A &lt;code>PhysicsActor&lt;/code> acts just like an {@link Object2D}, but it is special
<span class='linenumber'> 55</span> 	 * 		 in that it's rigid bodies are animated via a {@link Simulation}.  Without being added to a
<span class='linenumber'> 56</span> 	 * 		 {@link Simulation}, none of the physical bodies will be updated. 
<span class='linenumber'> 57</span> 	 * 
<span class='linenumber'> 58</span> 	 * @param name {String} The name of the actor object
<span class='linenumber'> 59</span> 	 * @extends Object2D
<span class='linenumber'> 60</span> 	 * @constructor
<span class='linenumber'> 61</span> 	 * @description Create a physics actor
<span class='linenumber'> 62</span> 	 */</span><span class="WHIT">
<span class='linenumber'> 63</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">PhysicsActor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object2D.extend</span><span class="PUNC">(</span><span class="COMM">/** @scope PhysicsActor.prototype */</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 64</span> 
<span class='linenumber'> 65</span> </span><span class="WHIT">		</span><span class="NAME">simulation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 66</span> </span><span class="WHIT">		</span><span class="NAME">rootBody</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 67</span> </span><span class="WHIT">		</span><span class="NAME">rigidBodies</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 68</span> </span><span class="WHIT">		</span><span class="NAME">joints</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 69</span> </span><span class="WHIT">		</span><span class="NAME">rPos</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 70</span> 
<span class='linenumber'> 71</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'> 72</span> 		 * @private
<span class='linenumber'> 73</span> 		 */</span><span class="WHIT">
<span class='linenumber'> 74</span> </span><span class="WHIT">		</span><span class="NAME">constructor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 75</span> </span><span class="WHIT">			</span><span class="NAME">this.base</span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"PhysicsActor"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 76</span> </span><span class="WHIT">			</span><span class="NAME">this.rootBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 77</span> </span><span class="WHIT">			</span><span class="NAME">this.rigidBodies</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 78</span> </span><span class="WHIT">			</span><span class="NAME">this.rPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 79</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 80</span> 
<span class='linenumber'> 81</span> </span><span class="WHIT">	   </span><span class="COMM">/**
<span class='linenumber'> 82</span> 	    * Remove all of the bodies and joints from the simulation before
<span class='linenumber'> 83</span> 	    * destroying the object.
<span class='linenumber'> 84</span> 	    */</span><span class="WHIT">
<span class='linenumber'> 85</span> </span><span class="WHIT">	   </span><span class="NAME">destroy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 86</span> </span><span class="WHIT">	      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.simulation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 87</span> </span><span class="WHIT">				</span><span class="COMM">// Remove bodies and joints from the simulation</span><span class="WHIT">
<span class='linenumber'> 88</span> </span><span class="WHIT">	         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRigidBodies</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 89</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 90</span> </span><span class="WHIT">					</span><span class="NAME">this.simulation.removeBody</span><span class="PUNC">(</span><span class="NAME">bodies</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 91</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 92</span> </span><span class="WHIT">	      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 93</span> </span><span class="WHIT">			</span><span class="NAME">this.rPos.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 94</span> </span><span class="WHIT">	      </span><span class="NAME">this.base</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 95</span> </span><span class="WHIT">	   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 96</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'> 97</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'> 98</span> 		 * Get the collection of rigid body components within the actor.
<span class='linenumber'> 99</span> 		 * @return {Array}
<span class='linenumber'>100</span> 		 */</span><span class="WHIT">
<span class='linenumber'>101</span> </span><span class="WHIT">		</span><span class="NAME">getRigidBodies</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>102</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.rigidBodies</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>103</span> </span><span class="WHIT">				</span><span class="NAME">this.rigidBodies</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getObjects</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>104</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">BaseBodyComponent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>105</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>106</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>107</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rigidBodies</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>108</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>109</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>110</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>111</span> 		 * Get the collection of joint components within the actor.
<span class='linenumber'>112</span> 		 * @return {Array}
<span class='linenumber'>113</span> 		 */</span><span class="WHIT">
<span class='linenumber'>114</span> </span><span class="WHIT">		</span><span class="NAME">getJoints</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>115</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.joints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>116</span> </span><span class="WHIT">				</span><span class="NAME">this.joints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getObjects</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>117</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">BaseJointComponent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>118</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>119</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>120</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.joints</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>121</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>122</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>123</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>124</span> 		 * Set the rigid body component which is considered to be the root
<span class='linenumber'>125</span> 		 * body.  When setting the position of a &lt;tt>PhysicsActor&lt;/tt>, all positions
<span class='linenumber'>126</span> 		 * are calculated relative to where the root body was originally set.
<span class='linenumber'>127</span> 		 * &lt;p/>
<span class='linenumber'>128</span> 		 * It is not necessary to set the root body if there is only one rigid body
<span class='linenumber'>129</span> 		 * in the actor.
<span class='linenumber'>130</span> 		 * 
<span class='linenumber'>131</span> 		 * @param body {BaseBodyComponent} The body to assign as the root
<span class='linenumber'>132</span> 		 */</span><span class="WHIT">
<span class='linenumber'>133</span> </span><span class="WHIT">		</span><span class="NAME">setRootBody</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">body</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>134</span> </span><span class="WHIT">			</span><span class="NAME">Assert</span><span class="PUNC">(</span><span class="NAME">BaseBodyComponent.isInstance</span><span class="PUNC">(</span><span class="NAME">body</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Root body is not a BaseBodyComponent"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>135</span> </span><span class="WHIT">			</span><span class="NAME">this.rootBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>136</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>137</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>138</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>139</span> 		 * Get the root body of the &lt;tt>PhysicsActor&lt;/tt>.  If no root object has been assigned,
<span class='linenumber'>140</span> 		 * the first rigid body component will be used.
<span class='linenumber'>141</span> 		 * @return {BaseBodyComponent}
<span class='linenumber'>142</span> 		 */</span><span class="WHIT">
<span class='linenumber'>143</span> </span><span class="WHIT">		</span><span class="NAME">getRootBody</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>144</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.rootBody</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>145</span> </span><span class="WHIT">				</span><span class="COMM">// Get all of the bodies and select the first to be the root </span><span class="WHIT">
<span class='linenumber'>146</span> </span><span class="WHIT">				</span><span class="NAME">this.rootBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRigidBodies</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>147</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>148</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rootBody</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>149</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>150</span> 
<span class='linenumber'>151</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>152</span>        * Get the position of the actor from the root body component.
<span class='linenumber'>153</span>        * @return {Point2D}
<span class='linenumber'>154</span>        */</span><span class="WHIT">
<span class='linenumber'>155</span> </span><span class="WHIT">      </span><span class="NAME">getPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>156</span> </span><span class="WHIT">         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getRootBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>157</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>158</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>159</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>160</span>        * Get the render position of the actor
<span class='linenumber'>161</span>        * @return {Point2D}
<span class='linenumber'>162</span>        */</span><span class="WHIT">
<span class='linenumber'>163</span> </span><span class="WHIT">      </span><span class="NAME">getRenderPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>164</span> </span><span class="WHIT">         </span><span class="NAME">this.rPos.set</span><span class="PUNC">(</span><span class="NAME">this.getPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>165</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>166</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>167</span> 
<span class='linenumber'>168</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>169</span> 		 * Get the rotation of the toy from the "physics" component.
<span class='linenumber'>170</span> 		 * @return {Number}
<span class='linenumber'>171</span> 		 */</span><span class="WHIT">
<span class='linenumber'>172</span> </span><span class="WHIT">		</span><span class="NAME">getRotation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>173</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getRootBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getRotation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>174</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>175</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>176</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>177</span> 		 * Get the uniform scale of the toy from the "physics" component.
<span class='linenumber'>178</span> 		 * @return {Number}
<span class='linenumber'>179</span> 		 */</span><span class="WHIT">
<span class='linenumber'>180</span> </span><span class="WHIT">		</span><span class="NAME">getScale</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>181</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getRootBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getScale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>182</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>183</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>184</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>185</span> 		 * Set the position of the actor.  If the actor is comprised of multiple rigid bodies,
<span class='linenumber'>186</span> 		 * the position will be set for all rigid bodies and joints, relative to the root body.
<span class='linenumber'>187</span> 		 * 
<span class='linenumber'>188</span> 		 * @param x {Number|Point2D} The X position, or a &lt;tt>Point2D&lt;/tt>
<span class='linenumber'>189</span> 		 * @param y {Number} The Y position, or &lt;tt>null&lt;/tt> if X is a &lt;tt>Point2D&lt;/tt>
<span class='linenumber'>190</span> 		 */</span><span class="WHIT">
<span class='linenumber'>191</span> </span><span class="WHIT">		</span><span class="NAME">setPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>192</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>193</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NAME">this.getRootBody</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>194</span> </span><span class="WHIT">			</span><span class="NAME">pt.sub</span><span class="PUNC">(</span><span class="NAME">pos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>195</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>196</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRigidBodies</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>197</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>198</span> </span><span class="WHIT">		 		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>199</span> </span><span class="WHIT">				</span><span class="NAME">bPos.add</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>200</span> </span><span class="WHIT">				</span><span class="NAME">bodies</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setPosition</span><span class="PUNC">(</span><span class="NAME">bPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>201</span> </span><span class="WHIT">		 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>202</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>203</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">joints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getJoints</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>204</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">joints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>205</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joints</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>206</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>207</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>208</span> </span><span class="WHIT">			</span><span class="NAME">pt.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>209</span> </span><span class="WHIT">			</span><span class="NAME">pos.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>210</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>211</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>212</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>213</span> 		 * Set the &lt;code>Simulation&lt;/code> this actor participates within.  When a &lt;code>PhysicsActor&lt;/code> 
<span class='linenumber'>214</span> 		 * is part of a running &lt;code>Simulation&lt;/code>, you must set the simulation so the physics components
<span class='linenumber'>215</span> 		 * can be properly added to the simulated world.
<span class='linenumber'>216</span> 		 * 
<span class='linenumber'>217</span> 		 * @param simulation {Simulation} The simulation this object is within
<span class='linenumber'>218</span> 		 */</span><span class="WHIT">
<span class='linenumber'>219</span> </span><span class="WHIT">		</span><span class="NAME">setSimulation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">simulation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>220</span> </span><span class="WHIT">			</span><span class="NAME">this.simulation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">simulation</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>221</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>222</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>223</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>224</span> 		 * Get the &lt;code>Simulation&lt;/code> this object participates within.
<span class='linenumber'>225</span> 		 * @return {Simulation}
<span class='linenumber'>226</span> 		 */</span><span class="WHIT">
<span class='linenumber'>227</span> </span><span class="WHIT">		</span><span class="NAME">getSimulation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>228</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.simulation</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>229</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>230</span> 
<span class='linenumber'>231</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>232</span> 		 * Start simulation of the physical components.
<span class='linenumber'>233</span> 		 */</span><span class="WHIT">
<span class='linenumber'>234</span> </span><span class="WHIT">		</span><span class="NAME">simulate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>235</span> </span><span class="WHIT">			</span><span class="COMM">// Start simulation on bodies first</span><span class="WHIT">
<span class='linenumber'>236</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRigidBodies</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>237</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">bodies</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>238</span> </span><span class="WHIT">		 		</span><span class="NAME">bodies</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">startSimulation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>239</span> </span><span class="WHIT">		 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>240</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>241</span> </span><span class="WHIT">			</span><span class="COMM">// Follow up with simulation of joints</span><span class="WHIT">
<span class='linenumber'>242</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">joints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getJoints</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>243</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">joints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>244</span> </span><span class="WHIT">		 		</span><span class="NAME">joints</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">startSimulation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>245</span> </span><span class="WHIT">		 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>246</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>247</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>248</span> </span><span class="WHIT">	   </span><span class="COMM">/**
<span class='linenumber'>249</span> 	    * Add a component to the physics actor.  The components will be
<span class='linenumber'>250</span> 	    * sorted based on their type then their priority within that type.
<span class='linenumber'>251</span> 	    * Components with a higher priority will be sorted before components
<span class='linenumber'>252</span> 	    * with a lower priority.  The sorting order for type is:
<span class='linenumber'>253</span> 	    * &lt;ul>
<span class='linenumber'>254</span> 	    * &lt;li>Input&lt;/li>
<span class='linenumber'>255</span> 	    * &lt;li>Transform&lt;/li>
<span class='linenumber'>256</span> 	    * &lt;li>Logic&lt;/li>
<span class='linenumber'>257</span> 	    * &lt;li>Collision&lt;/li>
<span class='linenumber'>258</span> 	    * &lt;li>Rendering&lt;/li>
<span class='linenumber'>259</span> 	    * &lt;/ul>
<span class='linenumber'>260</span> 	    *
<span class='linenumber'>261</span> 	    * @param component {BaseComponent} A component to add to the host.  If the component is a
<span class='linenumber'>262</span> 	    * 	{@link BaseBodyComponent} then the render component must be specified.
<span class='linenumber'>263</span> 	    * @param [renderComponent] {RenderComponent} The render component if the component is a
<span class='linenumber'>264</span> 	    * 	{@link BaseBodyComponent}
<span class='linenumber'>265</span> 	    */</span><span class="WHIT">
<span class='linenumber'>266</span> </span><span class="WHIT">		</span><span class="NAME">add</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">renderComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>267</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">BaseBodyComponent.isInstance</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>268</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>269</span> </span><span class="WHIT">				</span><span class="COMM">// Reset the list of rigid bodies so the list will be rebuilt</span><span class="WHIT">
<span class='linenumber'>270</span> </span><span class="WHIT">				</span><span class="NAME">this.rigidBodies</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>271</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>272</span> </span><span class="WHIT">				</span><span class="COMM">// Assure that there's a renderer for the body and then link the two</span><span class="WHIT">
<span class='linenumber'>273</span> </span><span class="WHIT">				</span><span class="NAME">Assert</span><span class="PUNC">(</span><span class="NAME">renderComponent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">RenderComponent.isInstance</span><span class="PUNC">(</span><span class="NAME">renderComponent</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Adding non-render component to body component"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>274</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>275</span> </span><span class="WHIT">				</span><span class="COMM">// Link the two so that when the body (transform) occurs, the renderer does its thing</span><span class="WHIT">
<span class='linenumber'>276</span> </span><span class="WHIT">				</span><span class="NAME">component.setRenderComponent</span><span class="PUNC">(</span><span class="NAME">renderComponent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>277</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>278</span> 
<span class='linenumber'>279</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">BaseJointComponent.isInstance</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>280</span> </span><span class="WHIT">				</span><span class="COMM">// Reset the list of joints so the list will be rebuilt</span><span class="WHIT">
<span class='linenumber'>281</span> </span><span class="WHIT">				</span><span class="NAME">this.joints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>282</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>283</span> 
<span class='linenumber'>284</span> </span><span class="WHIT">			</span><span class="COMM">// Add the component</span><span class="WHIT">
<span class='linenumber'>285</span> </span><span class="WHIT">			</span><span class="NAME">this.base</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>286</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>287</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>288</span> </span><span class="WHIT">	   </span><span class="COMM">/**
<span class='linenumber'>289</span> 	    * Update this object within the render context, at the specified timeslice.
<span class='linenumber'>290</span> 	    *
<span class='linenumber'>291</span> 	    * @param renderContext {RenderContext} The context the object will be rendered within.
<span class='linenumber'>292</span> 	    * @param time {Number} The global time within the engine.
<span class='linenumber'>293</span> 	    */</span><span class="WHIT">
<span class='linenumber'>294</span> </span><span class="WHIT">	   </span><span class="NAME">update</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">renderContext</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">time</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>295</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>296</span> </span><span class="WHIT">	      </span><span class="COMM">// Run the components</span><span class="WHIT">
<span class='linenumber'>297</span> </span><span class="WHIT">	      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.iterator</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>298</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>299</span> </span><span class="WHIT">	      </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">components.hasNext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>300</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">components.next</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>301</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isPhysicsComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">BaseBodyComponent.isInstance</span><span class="PUNC">(</span><span class="NAME">nextComponent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>302</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isPhysicsComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>303</span> </span><span class="WHIT">					</span><span class="NAME">renderContext.pushTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>304</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>305</span> </span><span class="WHIT">				</span><span class="NAME">nextComponent.execute</span><span class="PUNC">(</span><span class="NAME">renderContext</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">time</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>306</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isPhysicsComponent</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nextComponent.getRenderComponent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>307</span> </span><span class="WHIT">					</span><span class="COMM">// Make sure to execute the render component immediately following</span><span class="WHIT">
<span class='linenumber'>308</span> </span><span class="WHIT">					</span><span class="COMM">// the body component.</span><span class="WHIT">
<span class='linenumber'>309</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NAME">nextComponent.getLocalOrigin</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>310</span> </span><span class="WHIT">					</span><span class="NAME">pt.mul</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">nextComponent.getScale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>311</span> </span><span class="WHIT">					</span><span class="NAME">pt.neg</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>312</span> </span><span class="WHIT">					</span><span class="NAME">renderContext.setPosition</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>313</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>314</span> </span><span class="WHIT">					</span><span class="COMM">/* pragma:DEBUG_START */</span><span class="WHIT">
<span class='linenumber'>315</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Engine.getDebugMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>316</span> </span><span class="WHIT">			   		</span><span class="NAME">renderContext.drawFilledArc</span><span class="PUNC">(</span><span class="NAME">pt.neg</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">360</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>317</span> </span><span class="WHIT">			   	</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>318</span> </span><span class="WHIT">					</span><span class="COMM">/* pragma:DEBUG_END */</span><span class="WHIT">
<span class='linenumber'>319</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>320</span> </span><span class="WHIT">					</span><span class="NAME">nextComponent.getRenderComponent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">execute</span><span class="PUNC">(</span><span class="NAME">renderContext</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">time</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>321</span> </span><span class="WHIT">					</span><span class="NAME">pt.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>322</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>323</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isPhysicsComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>324</span> </span><span class="WHIT">					</span><span class="NAME">renderContext.popTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>325</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>326</span> </span><span class="WHIT">	      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>327</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>328</span> </span><span class="WHIT">			</span><span class="NAME">components.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>329</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>330</span> </span><span class="WHIT">			</span><span class="COMM">// Special case so we can skip the super class (HostObject)</span><span class="WHIT">
<span class='linenumber'>331</span> </span><span class="WHIT">	      </span><span class="NAME">HashContainer.prototype.update.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">renderContext</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">time</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>332</span> </span><span class="WHIT">	   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>333</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>334</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>335</span> 		 * @private
<span class='linenumber'>336</span> 		 */</span><span class="WHIT">
<span class='linenumber'>337</span> </span><span class="WHIT">		</span><span class="NAME">__noop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>338</span> </span><span class="WHIT">			</span><span class="COMM">// This function only serves to make sure that ObjectLoader exists</span><span class="WHIT">
<span class='linenumber'>339</span> </span><span class="WHIT">			</span><span class="COMM">// for the static methods below.</span><span class="WHIT">
<span class='linenumber'>340</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">q</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ObjectLoader.create</span><span class="PUNC">(</span><span class="STRN">"dummy"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>341</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>342</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>343</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">/** @scope PhysicsActor.prototype */</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Static</span><span class="WHIT">
<span class='linenumber'>344</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>345</span> </span><span class="WHIT">	   </span><span class="COMM">/**
<span class='linenumber'>346</span> 	    * Get the class name of this object
<span class='linenumber'>347</span> 	    * @return The string &lt;tt>PhysicsActor&lt;/tt>
<span class='linenumber'>348</span> 	    * @type String
<span class='linenumber'>349</span> 	    */</span><span class="WHIT">
<span class='linenumber'>350</span> </span><span class="WHIT">	   </span><span class="NAME">getClassName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>351</span> </span><span class="WHIT">	      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"PhysicsActor"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>352</span> </span><span class="WHIT">	   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>353</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>354</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>355</span> 		 * Resource loader for physics actor objects
<span class='linenumber'>356</span> 		 * @private
<span class='linenumber'>357</span> 		 */</span><span class="WHIT">
<span class='linenumber'>358</span> </span><span class="WHIT">		</span><span class="NAME">actorLoader</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>359</span> 
<span class='linenumber'>360</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>361</span> 		 * @private
<span class='linenumber'>362</span> 		 */</span><span class="WHIT">
<span class='linenumber'>363</span> </span><span class="WHIT">		</span><span class="NAME">resolved</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>364</span> </span><span class="WHIT">			</span><span class="NAME">PhysicsActor.actorLoader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ObjectLoader.create</span><span class="PUNC">(</span><span class="STRN">"ActorLoader"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>365</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>366</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>367</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>368</span> 		 * Helper method to load a physics object file which describes the objects
<span class='linenumber'>369</span> 		 * and joints which comprise the object.  The format consists of "parts"
<span class='linenumber'>370</span> 		 * which define the types of physical object ("circle", "box") and other
<span class='linenumber'>371</span> 		 * parameters required by each part.  Additionally, the format will load
<span class='linenumber'>372</span> 		 * joints which are used to link the parts together.
<span class='linenumber'>373</span> 		 * &lt;p/>
<span class='linenumber'>374</span> 		 * The actor object is loaded asynchronously which means it isn't immediately
<span class='linenumber'>375</span> 		 * available.  You get a reference to the object by calling {@link PhysicsActor#get}.
<span class='linenumber'>376</span> 		 * &lt;p/>
<span class='linenumber'>377</span> 		 * An example &lt;tt>PhysicsActor&lt;/tt> file can be found in the "/demos/physics2/"
<span class='linenumber'>378</span> 		 * demo game.
<span class='linenumber'>379</span> 		 * 
<span class='linenumber'>380</span> 		 * @param name {String} The unique reference name of the actor object 
<span class='linenumber'>381</span> 	    * @param url {String} The URL where the resource is located
<span class='linenumber'>382</span> 	    * @static
<span class='linenumber'>383</span> 		 */</span><span class="WHIT">
<span class='linenumber'>384</span> </span><span class="WHIT">		</span><span class="NAME">load</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>385</span> </span><span class="WHIT">			</span><span class="NAME">PhysicsActor.actorLoader.load</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>386</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>387</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>388</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>389</span> 		 * Determine the ready state of a physics actor loaded with {@link PhysicsActor#load}.
<span class='linenumber'>390</span> 		 * 
<span class='linenumber'>391</span> 		 * @param name {String} The unique reference name of the actor object
<span class='linenumber'>392</span> 		 * @return {Boolean} &lt;code>true&lt;/code> if the object is ready for use
<span class='linenumber'>393</span> 		 * @static
<span class='linenumber'>394</span> 		 */</span><span class="WHIT">
<span class='linenumber'>395</span> </span><span class="WHIT">		</span><span class="NAME">isReady</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>396</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">PhysicsActor.actorLoader.isReady</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>397</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>398</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>399</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='linenumber'>400</span> 		 * Get a unique instance of the actor defined by the reference name provided.
<span class='linenumber'>401</span> 		 * You can call this method multiple times to retrieve new instances of the object.
<span class='linenumber'>402</span> 		 * 
<span class='linenumber'>403</span> 		 * @param name {String} The unique reference name of the actor object
<span class='linenumber'>404</span> 		 * @param [objName] {String} The name to assign to the instance when created
<span class='linenumber'>405</span> 		 * @return {PhysicsActor} A new instance of the actor defined by "name"
<span class='linenumber'>406</span> 		 * @static
<span class='linenumber'>407</span> 		 */</span><span class="WHIT">
<span class='linenumber'>408</span> </span><span class="WHIT">		</span><span class="NAME">get</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">objName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>409</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toP2d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>410</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>411</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>412</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>413</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getRelativePosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">aV</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>414</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">aV</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">aV.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>415</span> </span><span class="WHIT">					</span><span class="COMM">// An absolute position</span><span class="WHIT">
<span class='linenumber'>416</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toP2d</span><span class="PUNC">(</span><span class="NAME">aV</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>417</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>418</span> </span><span class="WHIT">					</span><span class="COMM">// If the array has 3 values, the third is a relative position string</span><span class="WHIT">
<span class='linenumber'>419</span> </span><span class="WHIT">					</span><span class="COMM">// and the first two are an offset from that point.  Otherwise, we assume</span><span class="WHIT">
<span class='linenumber'>420</span> </span><span class="WHIT">					</span><span class="COMM">// the value is only the position string</span><span class="WHIT">
<span class='linenumber'>421</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">aV</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">aV.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">aV</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aV</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>422</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">aV</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">aV.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">toP2d</span><span class="PUNC">(</span><span class="NAME">aV</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>423</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Point2D.create</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>424</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>425</span> </span><span class="WHIT">					</span><span class="COMM">// Calculate the anchor, relative to the position of the object provided</span><span class="WHIT">
<span class='linenumber'>426</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj.getBoundingBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">offset</span><span class="PUNC">(</span><span class="NAME">obj.getPosition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>427</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">get</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>428</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bb.get</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>429</span> </span><span class="WHIT">					</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rel.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>430</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"center"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">obj.getCenter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>431</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"topleft"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>432</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"topright"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>433</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"bottomleft"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>434</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"bottomright"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>435</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"topcenter"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">c.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>436</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"bottomcenter"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">c.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>437</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"leftmiddle"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>438</span> </span><span class="WHIT">						</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"rightmiddle"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rPos.set</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>439</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>440</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>441</span> </span><span class="WHIT">					</span><span class="COMM">// Perform the offset</span><span class="WHIT">
<span class='linenumber'>442</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rPos.add</span><span class="PUNC">(</span><span class="NAME">offs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>443</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>444</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>445</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>446</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">def</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">PhysicsActor.actorLoader.get</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>447</span> </span><span class="WHIT">				 </span><span class="NAME">actor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">PhysicsActor.create</span><span class="PUNC">(</span><span class="NAME">objName</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jointParts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">relParts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>448</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">props</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"friction"</span><span class="PUNC">:</span><span class="STRN">"setFriction"</span><span class="PUNC">,</span><span class="STRN">"restitution"</span><span class="PUNC">:</span><span class="STRN">"setRestitution"</span><span class="PUNC">,</span><span class="STRN">"density"</span><span class="PUNC">:</span><span class="STRN">"setDensity"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>449</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>450</span> </span><span class="WHIT">			</span><span class="COMM">// Loop through the parts and build each component</span><span class="WHIT">
<span class='linenumber'>451</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">def.parts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>452</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">part</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">def.parts</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bc</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>453</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"circle"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>454</span> </span><span class="WHIT">					</span><span class="NAME">part.radius</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">def.scale</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>455</span> </span><span class="WHIT">					</span><span class="NAME">bc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CircleBodyComponent.create</span><span class="PUNC">(</span><span class="NAME">part.name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">part.radius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>456</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>457</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ext</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toP2d</span><span class="PUNC">(</span><span class="NAME">part.extents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>458</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>459</span> </span><span class="WHIT">						</span><span class="NAME">ext.mul</span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>460</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>461</span> </span><span class="WHIT">					</span><span class="NAME">bc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">BoxBodyComponent.create</span><span class="PUNC">(</span><span class="NAME">part.name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ext</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>462</span> </span><span class="WHIT">					</span><span class="NAME">ext.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>463</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>464</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>465</span> </span><span class="WHIT">				</span><span class="COMM">// Set friction, restitution, or density properties.  Both</span><span class="WHIT">
<span class='linenumber'>466</span> </span><span class="WHIT">				</span><span class="COMM">// defaults and per-part</span><span class="WHIT">
<span class='linenumber'>467</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">props</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>468</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>469</span> </span><span class="WHIT">						</span><span class="NAME">bc</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">def</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>470</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>471</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>472</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>473</span> </span><span class="WHIT">						</span><span class="NAME">bc</span><span class="PUNC">[</span><span class="NAME">props</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">part</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>474</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>475</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>476</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>477</span> </span><span class="WHIT">				</span><span class="COMM">// Add the component to the actor.  We'll let the developer set the renderer</span><span class="WHIT">
<span class='linenumber'>478</span> </span><span class="WHIT">				</span><span class="COMM">// for each body component.</span><span class="WHIT">
<span class='linenumber'>479</span> </span><span class="WHIT">				</span><span class="NAME">actor.add</span><span class="PUNC">(</span><span class="NAME">bc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>480</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>481</span> </span><span class="WHIT">				</span><span class="COMM">// Position the parts relative to each other, in world coordinates with the</span><span class="WHIT">
<span class='linenumber'>482</span> </span><span class="WHIT">				</span><span class="COMM">// origin at the top left corner of the world</span><span class="WHIT">
<span class='linenumber'>483</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$.isArray</span><span class="PUNC">(</span><span class="NAME">part.position</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">part.position.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>484</span> </span><span class="WHIT">					</span><span class="COMM">// Set the position of the part in absolute coordinates</span><span class="WHIT">
<span class='linenumber'>485</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toP2d</span><span class="PUNC">(</span><span class="NAME">part.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>486</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>487</span> </span><span class="WHIT">						</span><span class="NAME">bc.setScale</span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>488</span> </span><span class="WHIT">						</span><span class="NAME">pt.mul</span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>489</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>490</span> </span><span class="WHIT">					</span><span class="NAME">bc.setPosition</span><span class="PUNC">(</span><span class="NAME">pt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>491</span> </span><span class="WHIT">					</span><span class="NAME">pt.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>492</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.relativeTo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>493</span> </span><span class="WHIT">					</span><span class="COMM">// The position is either a string or a 3 element array.  In either case</span><span class="WHIT">
<span class='linenumber'>494</span> </span><span class="WHIT">					</span><span class="COMM">// the value contains a relative positioning string and possibly an offset</span><span class="WHIT">
<span class='linenumber'>495</span> </span><span class="WHIT">					</span><span class="NAME">relParts.push</span><span class="PUNC">(</span><span class="NAME">part</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>496</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>497</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>498</span> </span><span class="WHIT">				</span><span class="COMM">// Is there a joint defined?  Defer it until later when all the parts are loaded</span><span class="WHIT">
<span class='linenumber'>499</span> </span><span class="WHIT">				</span><span class="COMM">// This way we don't have to worry about invalid body references</span><span class="WHIT">
<span class='linenumber'>500</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.joint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>501</span> </span><span class="WHIT">					</span><span class="NAME">jointParts.push</span><span class="PUNC">(</span><span class="NAME">part</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>502</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>503</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>504</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>505</span> </span><span class="WHIT">			</span><span class="COMM">// Now that all the parts are created we need to perform 2 final steps</span><span class="WHIT">
<span class='linenumber'>506</span> </span><span class="WHIT">			</span><span class="COMM">// 1) Position any parts that are relative to others </span><span class="WHIT">
<span class='linenumber'>507</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rp</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">relParts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>508</span> </span><span class="WHIT">				</span><span class="COMM">// Get the component it is relative to and calculate it's position</span><span class="WHIT">
<span class='linenumber'>509</span> </span><span class="WHIT">				</span><span class="NAME">part</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">relParts</span><span class="PUNC">[</span><span class="NAME">rp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>510</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">relTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">part.relativeTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>511</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">part.position</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>512</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getRelativePosition</span><span class="PUNC">(</span><span class="NAME">rPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">relTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>513</span> </span><span class="WHIT">				</span><span class="NAME">bc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">part.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>514</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>515</span> </span><span class="WHIT">					</span><span class="NAME">bc.setScale</span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>516</span> </span><span class="WHIT">					</span><span class="NAME">pos.mul</span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>517</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>518</span> </span><span class="WHIT">				</span><span class="NAME">bc.setPosition</span><span class="PUNC">(</span><span class="NAME">pos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>519</span> </span><span class="WHIT">				</span><span class="NAME">pos.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>520</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>521</span> 
<span class='linenumber'>522</span> </span><span class="WHIT">			</span><span class="COMM">// 2) link the parts with any joints that were deferred until now</span><span class="WHIT">
<span class='linenumber'>523</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">jointParts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>524</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">part</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jointParts</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jc</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>525</span> </span><span class="WHIT">					 </span><span class="NAME">fromPart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.joint.linkFrom</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">part.joint.linkFrom</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">part.name</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>526</span> </span><span class="WHIT">					 </span><span class="NAME">toPart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.joint.linkTo</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">part.joint.linkTo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">part.name</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>527</span> </span><span class="WHIT">					 </span><span class="NAME">jointName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fromPart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">toPart</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>528</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>529</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.joint.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"distance"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>530</span> </span><span class="WHIT">					</span><span class="NAME">jc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">DistanceJointComponent.create</span><span class="PUNC">(</span><span class="NAME">jointName</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>531</span> </span><span class="WHIT">													  </span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">fromPart</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>532</span> </span><span class="WHIT">													  </span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">toPart</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>533</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>534</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toP2d</span><span class="PUNC">(</span><span class="NAME">part.joint.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>535</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>536</span> </span><span class="WHIT">						</span><span class="NAME">anchor.mul</span><span class="PUNC">(</span><span class="NAME">def.scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>537</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>538</span> 
<span class='linenumber'>539</span> </span><span class="WHIT">					</span><span class="NAME">jc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RevoluteJointComponent.create</span><span class="PUNC">(</span><span class="NAME">jointName</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>540</span> </span><span class="WHIT">													  </span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">fromPart</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>541</span> </span><span class="WHIT">													  </span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">toPart</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>542</span> </span><span class="WHIT">													  </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>543</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>544</span> </span><span class="WHIT">					</span><span class="COMM">// Joint rotational limits							</span><span class="WHIT">
<span class='linenumber'>545</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">upLim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">part.joint.maxLim</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>546</span> </span><span class="WHIT">						 </span><span class="NAME">lowLim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">part.joint.minLim</span><span class="PUNC">;</span><span class="WHIT">													  </span><span class="WHIT">
<span class='linenumber'>547</span> </span><span class="WHIT">					</span><span class="NAME">jc.setUpperLimitAngle</span><span class="PUNC">(</span><span class="NAME">upLim</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">upLim</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>548</span> </span><span class="WHIT">					</span><span class="NAME">jc.setLowerLimitAngle</span><span class="PUNC">(</span><span class="NAME">lowLim</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">lowLim</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>549</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>550</span> </span><span class="WHIT">					</span><span class="COMM">// Motor torque and speed</span><span class="WHIT">
<span class='linenumber'>551</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.joint.motorTorque</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>552</span> </span><span class="WHIT">						</span><span class="NAME">jc.setMotorTorque</span><span class="PUNC">(</span><span class="NAME">part.joint.motorTorque</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>553</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>554</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>555</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">part.joint.motorSpeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>556</span> </span><span class="WHIT">						</span><span class="NAME">jc.setMotorSpeed</span><span class="PUNC">(</span><span class="NAME">part.joint.motorSpeed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>557</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>558</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='linenumber'>559</span> </span><span class="WHIT">					</span><span class="NAME">anchor.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>560</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>561</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='linenumber'>562</span> </span><span class="WHIT">				</span><span class="COMM">// Add the joint to the actor</span><span class="WHIT">
<span class='linenumber'>563</span> </span><span class="WHIT">				</span><span class="NAME">actor.add</span><span class="PUNC">(</span><span class="NAME">jc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>564</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>565</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='linenumber'>566</span> </span><span class="WHIT">			</span><span class="NAME">Assert</span><span class="PUNC">(</span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">def.root</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"'root' of actor definition is not a valid part"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>567</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">def.root</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>568</span> </span><span class="WHIT">				</span><span class="NAME">actor.setRootBody</span><span class="PUNC">(</span><span class="NAME">actor.getComponent</span><span class="PUNC">(</span><span class="NAME">def.root</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>569</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>570</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='linenumber'>571</span> </span><span class="WHIT">			</span><span class="COMM">// Done, give them their actor</span><span class="WHIT">
<span class='linenumber'>572</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">actor</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>573</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>574</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>575</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='linenumber'>576</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">PhysicsActor</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>577</span> 
<span class='linenumber'>578</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span></pre>
<hr>

   <div class="jsdoc_copy">The Render Engine &copy;2008-2010 Brett Fattori, All Rights Reserved</div>

<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoctoolkit.org/" target="_parent">JsDoc Toolkit</a> 1.4.1b on Wed Nov 17 2010 19:58:39 GMT-0500 (EST)</div>
</body>
</html>